close all; clear all; clc;

load('hw5_data.mat');
for n = 1:length(scatN_array)
% env_db = 20*log10(env{n}/max(env{n}(:)));
% figure;
% imagesc(deg_scan(n_deg),r{n}(n_r{n}),env_db(n_r{n},n_deg)); colormap gray;

corr_i = find(th_scan == 0);
corr_j = find(r{n} >= foc_z,1);

[ax_corr_env{n},ax_corr_lag] = autocorr(env{n}(n_r{n},corr_i),round(length(n_r{n})/2)-1);
ax_corr_rf{n} = autocorr(rf{n}(n_r{n},corr_i),round(length(n_r{n})/2)-1);

ax_lag{n} = ax_corr_lag.*(1/fs)*1540/2;

[lat_corr_env{n},lat_corr_lag] = autocorr(env{n}(corr_j,:),round(length(n_deg)/2)-1);
lat_corr_rf{n} = autocorr(rf{n}(corr_j,n_deg),round(length(n_deg)/2)-1);

lat_lag{n} = lat_corr_lag.*th_int;

corr_env{n} = xcorr2(env{n}/max(env{n}(:)));
corr_rf{n} = xcorr2(rf{n}/max(rf{n}(:)));

% 
% figure;
% imagesc(deg_scan(n_deg),r{n}(n_r{n}),env_db(n_r{n},n_deg),[-40 0]); colormap gray;

% figure;
% hold on; p1 = plot(lat_lag{n},lat_corr_env{n},'r'); p2 = plot(lat_lag{n}, lat_corr_rf{n},'b'); hold on;
% legend([p1,p2],{'Detected','RF'}),ylabel('Lateral autocorrelation'); xlabel('Lag (cm)')

figure; hold on; plot(ax_lag{n},ax_corr_env{n},'r'); plot(ax_lag{n}, ax_corr_rf{n},'b'); hold on;

end